<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Happy Valentine Day</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
body{
margin:0;
overflow:hidden;
background:radial-gradient(circle at bottom,#1a0028 0%,#000 85%);
font-family:'Press Start 2P',monospace;
cursor:pointer;
}
canvas{display:block;}

#count,#msg,#hint{
position:absolute;
width:100%;
text-align:center;
color:white;
letter-spacing:2px;
}

#count{
top:40%;
font-size:80px;
text-shadow:0 0 30px #ff77aa;
}

#msg{
top:40%;
font-size:80px;
opacity:0;
transition:2s ease;
text-shadow:0 0 20px #ff99cc;
}

#hint{
bottom:20px;
font-size:10px;
opacity:0.5;
}
</style>
</head>
<body>

<div id="count">3</div>
<div id="msg">ä»Šæ™šçš„çƒŸèŠ±åˆšåˆšå¥½</div>
<div id="hint">è½»è½»ç‚¹ä¸€ä¸‹ âœ¨</div>

<canvas id="c"></canvas>

<script>
const canvas=document.getElementById("c");
const ctx=canvas.getContext("2d");

let WIDTH,HEIGHT;
function resize(){
WIDTH=canvas.width=window.innerWidth;
HEIGHT=canvas.height=window.innerHeight;
}
window.addEventListener("resize",resize);
resize();

const TAU=Math.PI*2;
const rand=(a,b)=>a+Math.random()*(b-a);

/////////////////////////////////////////////////
// â­ æ˜Ÿç©ºï¼ˆæŸ”ä¸€ç‚¹ï¼‰
/////////////////////////////////////////////////

const stars=[];
for(let i=0;i<250;i++){
stars.push({
x:rand(0,WIDTH),
y:rand(0,HEIGHT),
r:rand(0.5,1.3)
});
}

function drawStars(){
ctx.globalAlpha=0.6;
for(let s of stars){
ctx.fillStyle="white";
ctx.beginPath();
ctx.arc(s.x,s.y,s.r,0,TAU);
ctx.fill();
}
ctx.globalAlpha=1;
}

/////////////////////////////////////////////////
// ğŸ† ç²’å­
/////////////////////////////////////////////////

class Particle{
constructor(x,y,color,vx,vy,life,size){
this.x=x;
this.y=y;
this.color=color;
this.vx=vx;
this.vy=vy;
this.life=life;
this.size=size;
}

update(){
this.x+=this.vx;
this.y+=this.vy;

this.vy+=0.03;        // é‡åŠ›è½»ä¸€ç‚¹
this.vx*=0.99;        // æ…¢æ…¢å‡é€Ÿ
this.vy*=0.99;

this.life--;
}


draw(){
ctx.globalAlpha=this.life/120;

ctx.fillStyle=this.color;
ctx.beginPath();
ctx.arc(this.x,this.y,this.size,0,TAU);
ctx.fill();

ctx.globalAlpha=1;
}

}

let particles=[];
let rockets=[];
let show=false;

/////////////////////////////////////////////////
// ğŸ’¥ æŸ”å’ŒçƒŸèŠ±
/////////////////////////////////////////////////

function explode(x,y){

let palette=[
"#ff8fcf",
"#ff77aa",
"#e6a8ff",
"#ffd6f5"
];

let color=palette[Math.floor(Math.random()*palette.length)];

// ğŸŒ¸ ä¸»èŠ±ç“£å±‚
let petals=28;
for(let i=0;i<petals;i++){

    let angle=(TAU/petals)*i;
    let speed=rand(2.2,3.5);

    particles.push(new Particle(
        x,y,
        color,
        Math.cos(angle)*speed,
        Math.sin(angle)*speed,
        100,
        rand(1.8,2.6)
    ));
}

// ğŸŒ¸ ç¬¬äºŒå±‚ï¼ˆé”™ä½æ›´è‡ªç„¶ï¼‰
for(let i=0;i<petals;i++){

    let angle=(TAU/petals)*i + 0.1;
    let speed=rand(1.5,2.5);

    particles.push(new Particle(
        x,y,
        color,
        Math.cos(angle)*speed,
        Math.sin(angle)*speed,
        90,
        rand(1.5,2.2)
    ));
}

// âœ¨ ä¸­å¿ƒäº®ç‚¹
for(let i=0;i<6;i++){
    let angle=rand(0,TAU);
    let speed=rand(0.5,1.2);

    particles.push(new Particle(
        x,y,
        "white",
        Math.cos(angle)*speed,
        Math.sin(angle)*speed,
        50,
        2
    ));
}
}



/////////////////////////////////////////////////
// ğŸš€ ç«ç®­
/////////////////////////////////////////////////

class Rocket{
constructor(x,targetY){
this.x=x;
this.y=HEIGHT;
this.targetY=targetY;
this.vy=-rand(8,11);
this.exploded=false;
}

update(){
this.y+=this.vy;
this.vy+=0.05;

// æŸ”å°¾ç„°
particles.push(new Particle(
this.x,
this.y+6,
"rgba(255,150,200,0.6)",
rand(-0.5,0.5),
rand(1,2),
25,
1.8
));

if(this.y<=this.targetY&&!this.exploded){
explode(this.x,this.y);
this.exploded=true;
}
}

draw(){
ctx.fillStyle="#ff88bb";
ctx.fillRect(this.x,this.y,2,8);
}
}

/////////////////////////////////////////////////
// â¤ï¸ å¿ƒå½¢
/////////////////////////////////////////////////

let clickCount=0;
let heartPoints=[];
let heartIndex=0;
let ringMode=false;

function generateHeart(){
heartPoints=[];
for(let t=0;t<TAU;t+=0.06){
let x=16*Math.pow(Math.sin(t),3);
let y=-(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
heartPoints.push({
x:WIDTH/2+x*11,
y:HEIGHT*0.4+y*11
});
}
}

/////////////////////////////////////////////////
// â³ å€’è®¡æ—¶
/////////////////////////////////////////////////

let n=3;
const countEl=document.getElementById("count");
const msgEl=document.getElementById("msg");

const timer=setInterval(()=>{
n--;
if(n>0){
    countEl.innerText=n;
}else{

    countEl.style.display="none";

    msgEl.innerText="æƒ…äººèŠ‚å¿«ä¹";
    msgEl.style.opacity=1;
    msgEl.style.transform="scale(1)";

    // ğŸ’¥ æ–‡å­—çˆ†ç‚¸
    setTimeout(()=>{
        explode(WIDTH/2,HEIGHT*0.4);
    },600);

    // ğŸŒ« æ–‡å­—æ…¢æ…¢æ¶ˆå¤±
    setTimeout(()=>{
        msgEl.style.opacity=0;
    },1500);

    // ğŸ† ç­‰æ–‡å­—æ¶ˆå¤±åå†å¼€å§‹çƒŸèŠ±
    setTimeout(()=>{
        show=true;
    },2500);

    clearInterval(timer);
}
},1000);



/////////////////////////////////////////////////
// ç‚¹å‡»
/////////////////////////////////////////////////

canvas.addEventListener("click",e=>{
clickCount++;

if(clickCount===5){
generateHeart();
ringMode=true;
heartIndex=0;
}

rockets.push(new Rocket(e.clientX,rand(HEIGHT*0.35,HEIGHT*0.5)));
});

/////////////////////////////////////////////////
// ä¸»å¾ªç¯
/////////////////////////////////////////////////

function animate(){
requestAnimationFrame(animate);

ctx.fillStyle="rgba(0,0,25,0.18)";

ctx.fillRect(0,0,WIDTH,HEIGHT);

drawStars();

if(show && Math.random()<0.012){
rockets.push(new Rocket(rand(0,WIDTH),rand(HEIGHT*0.35,HEIGHT*0.5)));
}

rockets=rockets.filter(r=>!r.exploded);
rockets.forEach(r=>{r.update();r.draw();});

particles=particles.filter(p=>p.life>0);
particles.forEach(p=>{p.update();p.draw();});

// å¿ƒå½¢æ…¢æ…¢å‡ºç°ï¼ˆä¸è¿‡åˆ†ï¼‰
if(ringMode && heartIndex<heartPoints.length){
let p=heartPoints[heartIndex];
explode(p.x,p.y);
heartIndex+=3;
}
}

animate();
</script>
</body>
</html>
